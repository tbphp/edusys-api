import{d as J,s as W,a as i,r as X,p as d,q as f,t as v,y as Y,E as Z,B as o,b as a,F as j,K as N,C as h,m as P,x as V,D as y,G as ee,I as te,a8 as ue,aP as ae,aQ as ne}from"./index.e2c76f91.js";import{u as oe}from"./school.816c9426.js";import{T as F,B as se}from"./api.6c619aa7.js";import{u as ie}from"./chat.1cdc5011.js";import"./index.2ff8b4ca.js";import{_ as le}from"./index.b05a5e83.js";import{_ as re,F as de}from"./Form.aacf39cb.js";import"./index.4b39cb33.js";import{M as me}from"./Modal.5d229f12.js";import{_ as ce}from"./PlusOutlined.dc5a6a60.js";import{_ as _e}from"./index.e926f0d4.js";import{I as pe}from"./Input.2bd320be.js";import{_ as fe}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Dropdown.d95ea83c.js";import"./index.40f3feba.js";import"./styleChecker.246fbcd2.js";import"./index.a02c1863.js";import"./toArray.0de1e11b.js";import"./index.bdfe88c9.js";import"./Spin.6d37f8d4.js";import"./debounce.0814cde8.js";import"./Col.6bbac153.js";const M=B=>(ae("data-v-86d494e2"),B=B(),ne(),B),Fe={class:"mb-5"},ve={key:1,class:"text-lg font-bold"},Be={key:0},De={key:1},ge={key:2,class:"actions"},Ce=["onClick"],he=M(()=>v("a",{href:"#"},"\u91CD\u7F6E\u5BC6\u7801",-1)),ye=["onClick"],ke=M(()=>v("a",{class:"red",href:"#"},"\u5220\u9664",-1)),Se=J({__name:"index",setup(B){const{curSchool:s}=W(oe()),T=ie(),k=i([]),g=i(!1),S=i(0),D=i(1),x=10,E=[{title:"ID",dataIndex:"id",key:"id"},{title:"\u59D3\u540D",dataIndex:"name",key:"name"},{title:"\u8D26\u53F7",dataIndex:"username",key:"username"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",key:"created_at"},{title:"\u6700\u8FD1\u66F4\u65B0",dataIndex:"updated_at",key:"updated_at"}];s.value.is_owner&&E.push({title:"\u64CD\u4F5C",dataIndex:"action",key:"action"});const m=i(!1),c=i(!1),t=X({name:"",username:""}),q={username:[{required:!0,message:"\u8D26\u53F7\u5FC5\u586B"}],name:[{required:!0,message:"\u59D3\u540D\u5FC5\u586B"}]},l=i(0);_();function _(){g.value=!0,F.getStudents(s.value.id,{page:D.value,per_page:x}).then(e=>{k.value=e.list,S.value=e.total}).finally(()=>g.value=!1)}function b(e){e?(l.value=e.id,t.name=e.name,t.username=e.username):(l.value=0,t.name="",t.username=""),m.value=!0}function L(){if(!(c.value||!t.name||!t.username))return new Promise((e,u)=>{c.value=!0,l.value?F.editStudent(s.value.id,l.value,{name:t.name}).then(()=>{m.value=!1,e(""),_()}).catch(u).finally(()=>c.value=!1):F.addStudent(s.value.id,t).then(p=>{m.value=!1,e(p),p.password&&N.success({message:"\u5B66\u751F\u521B\u5EFA\u6210\u529F",description:`\u8BE5\u5B66\u751F\u767B\u5F55\u5BC6\u7801\u662F\uFF1A${p.password}\uFF0C\u8BF7\u590D\u5236\u4FDD\u5B58\u53D1\u9001\u7ED9\u5B66\u751F~`}),D.value=1,_()}).catch(()=>u()).finally(()=>c.value=!1)})}function O(e){D.value=e,_()}function U(e){F.resetPasswordOfStudent(s.value.id,e).then(u=>{u.password&&N.success({message:"\u5B66\u751F\u5BC6\u7801\u4FEE\u6539\u6210\u529F",description:`\u8BE5\u5B66\u751F\u767B\u5F55\u5BC6\u7801\u4FEE\u6539\u4E3A\uFF1A${u.password}\uFF0C\u8BF7\u590D\u5236\u4FDD\u5B58\u53D1\u9001\u7ED9\u5B66\u751F~`})})}function z(e){F.deleteStudent(s.value.id,e).then(()=>{ee.success("\u5220\u9664\u6210\u529F"),_()})}function G(e){T.openNewSession({identity:te.Student,id:e.id,name:e.name})}return(e,u)=>{const p=ce,K=se,I=_e,Q=le,w=pe,A=re,R=de,H=me,$=ue("time");return d(),f(j,null,[v("div",Fe,[Y(s).is_owner?(d(),Z(K,{key:0,type:"primary",onClick:b},{icon:o(()=>[a(p)]),default:o(()=>[h(" \u6DFB\u52A0\u5B66\u751F ")]),_:1})):(d(),f("p",ve,"\u5B66\u751F\u5217\u8868"))]),a(Q,{dataSource:k.value,columns:E,loading:g.value,pagination:{position:["bottomCenter"],current:D.value,hideOnSinglePage:!0,pageSize:x,total:S.value,onChange:O}},{bodyCell:o(({column:n,record:r})=>[n.key==="created_at"?P((d(),f("span",Be,[h(V(r.created_at),1)])),[[$]]):y("",!0),n.key==="updated_at"?P((d(),f("span",De,[h(V(r.updated_at),1)])),[[$]]):y("",!0),n.key==="action"?(d(),f("div",ge,[v("a",{href:"#",onClick:C=>b(r)},"\u7F16\u8F91",8,Ce),a(I,{title:"\u786E\u5B9A\u8981\u91CD\u7F6E\u5BC6\u7801?","ok-text":"\u91CD\u7F6E","cancel-text":"\u53D6\u6D88",onConfirm:C=>U(r.id)},{default:o(()=>[he]),_:2},1032,["onConfirm"]),v("a",{href:"#",onClick:C=>G(r)},"\u804A\u5929",8,ye),a(I,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5B66\u751F\u5417?","ok-text":"\u5220\u9664","cancel-text":"\u53D6\u6D88",onConfirm:C=>z(r.id)},{default:o(()=>[ke]),_:2},1032,["onConfirm"])])):y("",!0)]),_:1},8,["dataSource","loading","pagination"]),a(H,{visible:m.value,"onUpdate:visible":u[2]||(u[2]=n=>m.value=n),title:`${l.value?"\u7F16\u8F91":"\u6DFB\u52A0"}\u5B66\u751F`,"confirm-loading":c.value,onOk:L},{default:o(()=>[a(R,{model:t,rules:q},{default:o(()=>[a(A,{label:"\u59D3\u540D",name:"name"},{default:o(()=>[a(w,{value:t.name,"onUpdate:value":u[0]||(u[0]=n=>t.name=n),valueModifiers:{trim:!0},placeholder:"\u8F93\u5165\u59D3\u540D"},null,8,["value"])]),_:1}),a(A,{label:"\u8D26\u53F7",name:"username"},{default:o(()=>[a(w,{value:t.username,"onUpdate:value":u[1]||(u[1]=n=>t.username=n),valueModifiers:{trim:!0},placeholder:"\u8F93\u5165\u8D26\u53F7",disabled:!!l.value},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])],64)}}});const Je=fe(Se,[["__scopeId","data-v-86d494e2"]]);export{Je as default};
