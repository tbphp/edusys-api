import{d as J,s as W,a as l,r as X,p as r,q as c,t as g,y as Y,E as Z,B as o,b as a,F as j,K as N,C as y,m as P,x as V,D,G as ee,I as te,a8 as ue,aP as ae,aQ as ne}from"./index.e558b280.js";import{u as oe}from"./school.0d2b0ff8.js";import{T as F,B as se}from"./api.77d9259c.js";import{u as ie}from"./chat.da65f05e.js";import"./index.ad51bd24.js";import{_ as le}from"./index.7d5bbebe.js";import{_ as re,F as de}from"./Form.2e5ddcbb.js";import"./index.990fadd3.js";import{M as ce}from"./Modal.8ca78157.js";import{_ as me}from"./PlusOutlined.863c44e3.js";import{_ as _e}from"./index.a833a952.js";import{I as pe}from"./Input.0cfca6ea.js";import{_ as fe}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Dropdown.bb8db13b.js";import"./index.23e6ad97.js";import"./styleChecker.cf36301e.js";import"./index.cfc5f755.js";import"./toArray.acd79ea8.js";import"./index.e8ef54b2.js";import"./Spin.fb949baf.js";import"./debounce.e5eb5221.js";import"./Col.92aa9075.js";const M=v=>(ae("data-v-ba2f2d8c"),v=v(),ne(),v),Fe={class:"mb-5"},ve={key:1,class:"text-lg font-bold"},Be={key:0},De={key:1},ge={key:2,class:"actions"},Ce=["onClick"],he=M(()=>g("a",{href:"#"},"\u91CD\u7F6E\u5BC6\u7801",-1)),ye=["onClick"],ke=M(()=>g("a",{class:"red",href:"#"},"\u5220\u9664",-1)),Se=J({__name:"index",setup(v){const{curSchool:s}=W(oe()),T=ie(),k=l([]),C=l(!1),S=l(0),B=l(1),x=10,b=[{title:"ID",dataIndex:"id",key:"id"},{title:"\u59D3\u540D",dataIndex:"name",key:"name"},{title:"\u8D26\u53F7",dataIndex:"username",key:"username"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",key:"created_at"},{title:"\u6700\u8FD1\u66F4\u65B0",dataIndex:"updated_at",key:"updated_at"}];s.value.is_owner&&b.push({title:"\u64CD\u4F5C",dataIndex:"action",key:"action"});const m=l(!1),_=l(!1),t=X({name:"",username:""}),q={username:[{required:!0,message:"\u8D26\u53F7\u5FC5\u586B"}],name:[{required:!0,message:"\u59D3\u540D\u5FC5\u586B"}]},d=l(0);p();function p(){C.value=!0,F.getStudents(s.value.id,{page:B.value,per_page:x}).then(e=>{k.value=e.list,S.value=e.total}).finally(()=>C.value=!1)}function E(e){e?(d.value=e.id,t.name=e.name,t.username=e.username):(d.value=0,t.name="",t.username=""),m.value=!0}function L(){if(!(_.value||!t.name||!t.username))return new Promise((e,u)=>{_.value=!0,d.value?F.editStudent(s.value.id,d.value,{name:t.name}).then(()=>{m.value=!1,e(""),p()}).catch(u).finally(()=>_.value=!1):F.addStudent(s.value.id,t).then(f=>{m.value=!1,e(f),f.password&&N.success({message:"\u5B66\u751F\u521B\u5EFA\u6210\u529F",description:`\u8BE5\u5B66\u751F\u767B\u5F55\u5BC6\u7801\u662F\uFF1A${f.password}\uFF0C\u8BF7\u590D\u5236\u4FDD\u5B58\u53D1\u9001\u7ED9\u5B66\u751F~`}),B.value=1,p()}).catch(()=>u()).finally(()=>_.value=!1)})}function O(e){B.value=e,p()}function U(e){F.resetPasswordOfStudent(s.value.id,e).then(u=>{u.password&&N.success({message:"\u5B66\u751F\u5BC6\u7801\u4FEE\u6539\u6210\u529F",description:`\u8BE5\u5B66\u751F\u767B\u5F55\u5BC6\u7801\u4FEE\u6539\u4E3A\uFF1A${u.password}\uFF0C\u8BF7\u590D\u5236\u4FDD\u5B58\u53D1\u9001\u7ED9\u5B66\u751F~`})})}function z(e){F.deleteStudent(s.value.id,e).then(()=>{ee.success("\u5220\u9664\u6210\u529F"),p()})}function G(e){T.openNewSession({identity:te.Student,id:e.id,name:e.name})}return(e,u)=>{const f=me,K=se,I=_e,Q=le,w=pe,A=re,R=de,H=ce,$=ue("time");return r(),c(j,null,[g("div",Fe,[Y(s).is_owner?(r(),Z(K,{key:0,type:"primary",onClick:E},{icon:o(()=>[a(f)]),default:o(()=>[y(" \u6DFB\u52A0\u5B66\u751F ")]),_:1})):(r(),c("p",ve,"\u5B66\u751F\u5217\u8868"))]),a(Q,{dataSource:k.value,columns:b,loading:C.value,pagination:{position:["bottomCenter"],current:B.value,hideOnSinglePage:!0,pageSize:x,total:S.value,onChange:O}},{bodyCell:o(({column:n,record:i})=>[n.key==="created_at"?P((r(),c("span",Be,[y(V(i.created_at),1)])),[[$]]):D("",!0),n.key==="updated_at"?P((r(),c("span",De,[y(V(i.updated_at),1)])),[[$]]):D("",!0),n.key==="action"?(r(),c("div",ge,[g("a",{href:"#",onClick:h=>E(i)},"\u7F16\u8F91",8,Ce),a(I,{title:"\u786E\u5B9A\u8981\u91CD\u7F6E\u5BC6\u7801?","ok-text":"\u91CD\u7F6E","cancel-text":"\u53D6\u6D88",onConfirm:h=>U(i.id)},{default:o(()=>[he]),_:2},1032,["onConfirm"]),i.is_owner?(r(),c("a",{key:0,href:"#",onClick:h=>G(i)},"\u804A\u5929",8,ye)):D("",!0),a(I,{title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u5B66\u751F\u5417?","ok-text":"\u5220\u9664","cancel-text":"\u53D6\u6D88",onConfirm:h=>z(i.id)},{default:o(()=>[ke]),_:2},1032,["onConfirm"])])):D("",!0)]),_:1},8,["dataSource","loading","pagination"]),a(H,{visible:m.value,"onUpdate:visible":u[2]||(u[2]=n=>m.value=n),title:`${d.value?"\u7F16\u8F91":"\u6DFB\u52A0"}\u5B66\u751F`,"confirm-loading":_.value,onOk:L},{default:o(()=>[a(R,{model:t,rules:q},{default:o(()=>[a(A,{label:"\u59D3\u540D",name:"name"},{default:o(()=>[a(w,{value:t.name,"onUpdate:value":u[0]||(u[0]=n=>t.name=n),valueModifiers:{trim:!0},placeholder:"\u8F93\u5165\u59D3\u540D"},null,8,["value"])]),_:1}),a(A,{label:"\u8D26\u53F7",name:"username"},{default:o(()=>[a(w,{value:t.username,"onUpdate:value":u[1]||(u[1]=n=>t.username=n),valueModifiers:{trim:!0},placeholder:"\u8F93\u5165\u8D26\u53F7",disabled:!!d.value},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","confirm-loading"])],64)}}});const Je=fe(Se,[["__scopeId","data-v-ba2f2d8c"]]);export{Je as default};
